// Written by Aaron Barge
// Copyright 2022

#include "test_approx.h"

#include <math.h>

#define TEST_SIZE 400

constexpr atn::TestInfo data[TEST_SIZE] = {
    {{20, 20}, 125.6637061}, {{19, 20}, 122.5422527}, {{20, 19}, 122.5422527},
    {{18, 20}, 119.4632087}, {{20, 18}, 119.4632087}, {{19, 19}, 119.3805208},
    {{17, 20}, 116.4300496}, {{20, 17}, 116.4300496}, {{18, 19}, 116.2601561},
    {{19, 18}, 116.2601561}, {{16, 20}, 113.4466716}, {{20, 16}, 113.4466716},
    {{17, 19}, 113.1846188}, {{19, 17}, 113.1846188}, {{18, 18}, 113.0973355},
    {{15, 20}, 110.5174608}, {{20, 15}, 110.5174608}, {{16, 19}, 110.1577953},
    {{19, 16}, 110.1577953}, {{17, 18}, 109.978184},  {{18, 17}, 109.978184},
    {{14, 20}, 107.6473796}, {{20, 14}, 107.6473796}, {{15, 19}, 107.1840702},
    {{19, 15}, 107.1840702}, {{16, 18}, 106.90657},   {{18, 16}, 106.90657},
    {{17, 17}, 106.8141502}, {{13, 20}, 104.842072},  {{20, 13}, 104.842072},
    {{14, 19}, 104.2684148}, {{19, 14}, 104.2684148}, {{15, 18}, 103.8868679},
    {{18, 15}, 103.8868679}, {{16, 17}, 103.6963589}, {{17, 16}, 103.6963589},
    {{12, 20}, 102.1079955}, {{20, 12}, 102.1079955}, {{13, 19}, 101.4164966},
    {{19, 13}, 101.4164966}, {{14, 18}, 100.924049},  {{18, 14}, 100.924049},
    {{15, 17}, 100.6291637}, {{17, 15}, 100.6291637}, {{16, 16}, 100.5309649},
    {{11, 20}, 99.45258801}, {{20, 11}, 99.45258801}, {{12, 19}, 98.63481572},
    {{19, 12}, 98.63481572}, {{13, 18}, 98.02379447}, {{18, 13}, 98.02379447},
    {{14, 17}, 97.61752486}, {{17, 14}, 97.61752486}, {{15, 16}, 97.41470933},
    {{16, 15}, 97.41470933}, {{10, 20}, 96.88448221}, {{20, 10}, 96.88448221},
    {{11, 19}, 95.93087863}, {{19, 11}, 95.93087863}, {{12, 18}, 95.19263754},
    {{18, 12}, 95.19263754}, {{13, 17}, 94.66712613}, {{17, 13}, 94.66712613},
    {{9, 20}, 94.41378488},  {{20, 9}, 94.41378488},  {{14, 16}, 94.35252848},
    {{16, 14}, 94.35252848}, {{15, 15}, 94.24777961}, {{10, 19}, 93.31342102},
    {{19, 10}, 93.31342102}, {{11, 18}, 92.43814352}, {{18, 11}, 92.43814352},
    {{8, 20}, 92.05245038},  {{20, 8}, 92.05245038},  {{12, 17}, 91.78452172},
    {{17, 12}, 91.78452172}, {{13, 16}, 91.35009468}, {{16, 13}, 91.35009468},
    {{14, 15}, 91.13327166}, {{15, 14}, 91.13327166}, {{9, 19}, 90.79269995},
    {{19, 9}, 90.79269995},  {{7, 20}, 89.81479146},  {{20, 7}, 89.81479146},
    {{10, 18}, 89.7691424},  {{18, 10}, 89.7691424},  {{11, 17}, 88.97732383},
    {{17, 11}, 88.97732383}, {{12, 16}, 88.41396864}, {{16, 12}, 88.41396864},
    {{8, 19}, 88.3808843},   {{19, 8}, 88.3808843},   {{13, 15}, 88.07682986},
    {{15, 13}, 88.07682986}, {{14, 14}, 87.9645943},  {{6, 20}, 87.71820138},
    {{20, 6}, 87.71820138},  {{9, 18}, 87.19603398},  {{18, 9}, 87.19603398},
    {{10, 17}, 86.25444507}, {{17, 10}, 86.25444507}, {{7, 19}, 86.09259058},
    {{19, 7}, 86.09259058},  {{5, 20}, 85.78421766},  {{20, 5}, 85.78421766},
    {{11, 16}, 85.5517944},  {{16, 11}, 85.5517944},  {{12, 15}, 85.08500367},
    {{15, 12}, 85.08500367}, {{13, 14}, 84.85209296}, {{14, 13}, 84.85209296},
    {{8, 18}, 84.73119708},  {{18, 8}, 84.73119708},  {{4, 20}, 84.04017717},
    {{20, 4}, 84.04017717},  {{6, 19}, 83.9456416},   {{19, 6}, 83.9456416},
    {{9, 17}, 83.62641762},  {{17, 9}, 83.62641762},  {{10, 16}, 82.77255214},
    {{16, 10}, 82.77255214}, {{3, 20}, 82.52199546},  {{20, 3}, 82.52199546},
    {{7, 18}, 82.38955202},  {{18, 7}, 82.38955202},  {{11, 15}, 82.16545018},
    {{15, 11}, 82.16545018}, {{5, 19}, 81.96218595},  {{19, 5}, 81.96218595},
    {{12, 14}, 81.80228423}, {{14, 12}, 81.80228423}, {{13, 13}, 81.68140899},
    {{2, 20}, 81.27937098},  {{20, 2}, 81.27937098},  {{8, 17}, 81.10582233},
    {{17, 8}, 81.10582233},  {{1, 20}, 80.38718005},  {{20, 1}, 80.38718005},
    {{6, 18}, 80.18935932},  {{18, 6}, 80.18935932},  {{4, 19}, 80.17044274},
    {{19, 4}, 80.17044274},  {{9, 16}, 80.08689226},  {{16, 9}, 80.08689226},
    {{10, 15}, 79.32719795}, {{15, 10}, 79.32719795}, {{11, 14}, 78.82281507},
    {{14, 11}, 78.82281507}, {{7, 17}, 78.70788041},  {{17, 7}, 78.70788041},
    {{3, 19}, 78.60763566},  {{19, 3}, 78.60763566},  {{12, 13}, 78.57123541},
    {{13, 12}, 78.57123541}, {{5, 18}, 78.1534003},   {{18, 5}, 78.1534003},
    {{8, 16}, 77.50758576},  {{16, 8}, 77.50758576},  {{2, 19}, 77.32550435},
    {{19, 2}, 77.32550435},  {{9, 15}, 76.58099659},  {{15, 9}, 76.58099659},
    {{6, 17}, 76.45129543},  {{17, 6}, 76.45129543},  {{1, 19}, 76.40248437},
    {{19, 1}, 76.40248437},  {{4, 18}, 76.31082042},  {{18, 4}, 76.31082042},
    {{10, 14}, 75.92273787}, {{14, 10}, 75.92273787}, {{11, 13}, 75.52918029},
    {{13, 11}, 75.52918029}, {{12, 12}, 75.39822369}, {{7, 16}, 75.05014749},
    {{16, 7}, 75.05014749},  {{3, 18}, 74.7002345},   {{18, 3}, 74.7002345},
    {{5, 17}, 74.35950135},  {{17, 5}, 74.35950135},  {{8, 15}, 73.93979018},
    {{15, 8}, 73.93979018},  {{2, 18}, 73.375576},    {{18, 2}, 73.375576},
    {{9, 14}, 73.11287659},  {{14, 9}, 73.11287659},  {{6, 16}, 72.73372557},
    {{16, 6}, 72.73372557},  {{10, 13}, 72.56428894}, {{13, 10}, 72.56428894},
    {{4, 17}, 72.46261488},  {{17, 4}, 72.46261488},  {{1, 18}, 72.41913762},
    {{18, 1}, 72.41913762},  {{11, 12}, 72.29078282}, {{12, 11}, 72.29078282},
    {{7, 15}, 71.41937436},  {{15, 7}, 71.41937436},  {{3, 17}, 70.80073074},
    {{17, 3}, 70.80073074},  {{5, 16}, 70.58242358},  {{16, 5}, 70.58242358},
    {{8, 14}, 70.40632439},  {{14, 8}, 70.40632439},  {{9, 13}, 69.68742709},
    {{13, 9}, 69.68742709},  {{2, 17}, 69.4301453},   {{17, 2}, 69.4301453},
    {{10, 12}, 69.25791196}, {{12, 10}, 69.25791196}, {{11, 11}, 69.11503838},
    {{6, 15}, 69.03933779},  {{15, 6}, 69.03933779},  {{4, 16}, 68.62737413},
    {{16, 4}, 68.62737413},  {{1, 17}, 68.43734562},  {{17, 1}, 68.43734562},
    {{7, 14}, 67.81913754},  {{14, 7}, 67.81913754},  {{8, 13}, 66.91180433},
    {{13, 8}, 66.91180433},  {{3, 16}, 66.91024603},  {{16, 3}, 66.91024603},
    {{5, 15}, 66.8244661},   {{15, 5}, 66.8244661},   {{9, 12}, 66.31047648},
    {{12, 9}, 66.31047648},  {{10, 11}, 66.01085094}, {{11, 10}, 66.01085094},
    {{2, 16}, 65.48988595},  {{16, 2}, 65.48988595},  {{6, 14}, 65.3713335},
    {{14, 6}, 65.3713335},   {{4, 15}, 64.80695047},  {{15, 4}, 64.80695047},
    {{1, 16}, 64.45735897},  {{16, 1}, 64.45735897},  {{7, 13}, 64.25370743},
    {{13, 7}, 64.25370743},  {{8, 12}, 63.46175836},  {{12, 8}, 63.46175836},
    {{5, 14}, 63.08838535},  {{14, 5}, 63.08838535},  {{3, 15}, 63.03013288},
    {{15, 3}, 63.03013288},  {{9, 11}, 62.98903113},  {{11, 9}, 62.98903113},
    {{10, 10}, 62.83185307}, {{6, 13}, 61.73356026},  {{13, 6}, 61.73356026},
    {{2, 15}, 61.55561744},  {{15, 2}, 61.55561744},  {{4, 14}, 61.00358136},
    {{14, 4}, 61.00358136},  {{7, 12}, 60.72823156},  {{12, 7}, 60.72823156},
    {{1, 15}, 60.47948601},  {{15, 1}, 60.47948601},  {{8, 11}, 60.06287446},
    {{11, 8}, 60.06287446},  {{9, 10}, 59.73160433},  {{10, 9}, 59.73160433},
    {{5, 13}, 59.3775184},   {{13, 5}, 59.3775184},   {{3, 14}, 59.16203881},
    {{14, 3}, 59.16203881},  {{6, 12}, 58.13068932},  {{12, 6}, 58.13068932},
    {{2, 14}, 57.62834776},  {{14, 2}, 57.62834776},  {{7, 11}, 57.24898132},
    {{11, 7}, 57.24898132},  {{4, 13}, 57.21999785},  {{13, 4}, 57.21999785},
    {{8, 10}, 56.72333578},  {{10, 8}, 56.72333578},  {{9, 9}, 56.54866776},
    {{1, 14}, 56.5041108},   {{14, 1}, 56.5041108},   {{5, 12}, 55.69594937},
    {{12, 5}, 55.69594937},  {{3, 13}, 55.30799368},  {{13, 3}, 55.30799368},
    {{6, 11}, 54.5684568},   {{11, 6}, 54.5684568},   {{7, 10}, 53.82368981},
    {{10, 7}, 53.82368981},  {{2, 13}, 53.70933221},  {{13, 2}, 53.70933221},
    {{4, 12}, 53.45957288},  {{12, 4}, 53.45957288},  {{8, 9}, 53.453285},
    {{9, 8}, 53.453285},     {{1, 13}, 52.53171827},  {{13, 1}, 52.53171827},
    {{5, 11}, 52.04873815},  {{11, 5}, 52.04873815},  {{3, 12}, 51.4705306},
    {{12, 3}, 51.4705306},   {{6, 10}, 51.05399773},  {{10, 6}, 51.05399773},
    {{7, 9}, 50.4620245},    {{9, 7}, 50.4620245},    {{8, 8}, 50.26548246},
    {{2, 12}, 49.80015633},  {{12, 2}, 49.80015633},  {{4, 11}, 49.72652764},
    {{11, 4}, 49.72652764},  {{1, 12}, 48.56293031},  {{12, 1}, 48.56293031},
    {{5, 10}, 48.4422411},   {{10, 5}, 48.4422411},   {{3, 11}, 47.65285675},
    {{11, 3}, 47.65285675},  {{6, 9}, 47.59631877},   {{9, 6}, 47.59631877},
    {{7, 8}, 47.17626424},   {{8, 7}, 47.17626424},   {{4, 10}, 46.02622519},
    {{10, 4}, 46.02622519},  {{2, 11}, 45.90285503},  {{11, 2}, 45.90285503},
    {{5, 9}, 44.8845712},    {{9, 5}, 44.8845712},    {{1, 11}, 44.59855874},
    {{11, 1}, 44.59855874},  {{6, 8}, 44.20698432},   {{8, 6}, 44.20698432},
    {{7, 7}, 43.98229715},   {{3, 10}, 43.85910069},  {{10, 3}, 43.85910069},
    {{4, 9}, 42.36559854},   {{9, 4}, 42.36559854},   {{2, 10}, 42.02008859},
    {{10, 2}, 42.02008859},  {{5, 8}, 41.38627607},   {{8, 5}, 41.38627607},
    {{6, 7}, 40.90114212},   {{7, 6}, 40.90114212},   {{1, 10}, 40.63968549},
    {{10, 1}, 40.63968549},  {{3, 9}, 40.09467966},   {{9, 3}, 40.09467966},
    {{4, 8}, 38.75379288},   {{8, 4}, 38.75379288},   {{2, 9}, 38.15541021},
    {{9, 2}, 38.15541021},   {{5, 7}, 37.96136893},   {{7, 5}, 37.96136893},
    {{6, 6}, 37.69911184},   {{1, 9}, 36.687788},     {{9, 1}, 36.687788},
    {{3, 8}, 36.36686278},   {{8, 3}, 36.36686278},   {{4, 7}, 35.2031622},
    {{7, 4}, 35.2031622},    {{5, 6}, 34.62895598},   {{6, 5}, 34.62895598},
    {{2, 8}, 34.31368706},   {{8, 2}, 34.31368706},   {{1, 8}, 32.74494297},
    {{8, 1}, 32.74494297},   {{3, 7}, 32.68566675},   {{7, 3}, 32.68566675},
    {{4, 6}, 31.73087918},   {{6, 4}, 31.73087918},   {{5, 5}, 31.41592654},
    {{2, 7}, 30.50179068},   {{7, 2}, 30.50179068},   {{3, 6}, 29.06534466},
    {{6, 3}, 29.06534466},   {{1, 7}, 28.81417388},   {{7, 1}, 28.81417388},
    {{4, 5}, 28.36166789},   {{5, 4}, 28.36166789},   {{2, 6}, 26.72978644},
    {{6, 2}, 26.72978644},   {{3, 5}, 25.52699886},   {{5, 3}, 25.52699886},
    {{4, 4}, 25.13274123},   {{1, 6}, 24.90007817},   {{6, 1}, 24.90007817},
    {{2, 5}, 23.0131126},    {{5, 2}, 23.0131126},    {{3, 4}, 22.10349216},
    {{4, 3}, 22.10349216},   {{1, 5}, 21.01004429},   {{5, 1}, 21.01004429},
    {{2, 4}, 19.37689644},   {{4, 2}, 19.37689644},   {{3, 3}, 18.84955592},
    {{1, 4}, 17.15684353},   {{4, 1}, 17.15684353},   {{2, 3}, 15.86543959},
    {{3, 2}, 15.86543959},   {{1, 3}, 13.36489322},   {{3, 1}, 13.36489322},
    {{2, 2}, 12.56637061},   {{1, 2}, 9.688448221},   {{2, 1}, 9.688448221},
    {{1, 1}, 6.283185307}};

double atn::test_approx(const atn::Calculator& calc, double max_value) {
  double result = 0.0;
  double calc_perimeter;
  for (uint16_t i = 0; i < TEST_SIZE; ++i) {
    calc_perimeter = calc.calculate(data[i].ellipse);
    result += 100.0 * fabs(calc_perimeter - data[i].expected);
    if (max_value < result) return max_value + EPSILON;
  }
  return result;
}
